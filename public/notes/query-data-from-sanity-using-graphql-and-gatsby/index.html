<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    <title>Query data from Sanity using GraphQL | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.</title>
    <meta name="title" content="Query data from Sanity using GraphQL | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    
    <meta name="description" content="Learn how to query structured content in Sanity with GraphQl and display the content in a Gatsby website">
    <meta name="keywords" content="Data Engineering, Data Science, AI, Analytics, Design, UX, UI, Product">
    <meta http-equiv="content-language" content="en" />
    
    <meta property="og:title" content="Query data from Sanity using GraphQL | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    <meta property="og:description" content="Learn how to query structured content in Sanity with GraphQl and display the content in a Gatsby website">
    <meta property="og:site_name" content="Query data from Sanity using GraphQL | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://azharkhan.in/notes/query-data-from-sanity-using-graphql-and-gatsby/">
    
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://azharkhan.in/notes/query-data-from-sanity-using-graphql-and-gatsby/">
    <meta property="twitter:title" content="Query data from Sanity using GraphQL - Azhar Khan">
    <meta property="twitter:description" content=" Learn how to query structured content in Sanity with GraphQl and display the content in a Gatsby website Blog posts on code and design by github.com/XOR97">
    <link rel="canonical" href="https://azharkhan.in/notes/query-data-from-sanity-using-graphql-and-gatsby/">
    
    
    
    <meta name="p:domain_verify" content="c60dc1e9be844be29f0fb5525b9afe6f"/>
    
    <meta name="google-site-verification" content="9G-wiIrmxQgDxbcs3a3xPW--q3Mxb1VGFN7BsEfJdDk" />
    
    <meta name="pinterest" content="nopin" />
        
    <meta name="author" content="Azhar Khan">
    <link href="mailto:azhar932@icloud.com" rel="me">
    <link href="https://twitter.com/Azhr_K_" rel="me">
    <link href="https://github.com/XOR97" rel="me">
    <link href="https://www.linkedin.com/in/azhar93/" rel="me">
    
    <link rel="webmention" href="https://webmention.io/harrycresswell.com/webmention" />
    <link rel="pingback" href="https://webmention.io/harrycresswell.com/xmlrpc" />
    
    
      
      
       
      
      
      <link rel="stylesheet" href="https://azharkhan.in/css/main.min.bf08fe8d86332cb842d75cf7df24b0b53fd52f2d350e68cea9eea8bdf244050b.css" integrity="sha256-vwj&#43;jYYzLLhC11z33ySwtT/VLy01DmjOqe6ovfJEBQs=" media="screen">
    
    
    <link rel="apple-touch-icon" href="https://azharkhan.in/img/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://azharkhan.in/img/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://azharkhan.in/img/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="shortcut icon" href="https://azharkhan.in/img/favicon.ico" type="image/x-icon">
    
    </head>
	<body class="Wrapper h-card">
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header class="Header">
    <div class="Title">
      <a class="p-name u-url" rel="me" href="https://azharkhan.in/">Azhar Khan</a>
      <div hidden>
          <img class="u-photo" src="https://harrycresswell.com/img/hc.jpg" alt="Harry Cresswell">
          <p class="p-note">Azhar Khan is an independent data engineer and developer from Ottawa, Canada.</p>
          <a href="mailto:studio@harrycresswell.com" rel="me" class="u-email">studio@harrycresswell.com</a>
      </div>
    </div>
    <nav class="Nav" aria-label="Main Navigation">
      <ul class="Nav-list">
       
        
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/articles/">Articles</a>
        </li>
      
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/notes/">Notes</a>
        </li>
      
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/tags/">Tags</a>
        </li>
      
      </ul>
    </nav>
  </header>

    <main id="main-content" class="Container">
    
      
  <article id="content" class="Post h-entry">

      <header class="PostHeader">
          <h1 class="PostHeader-title p-name">Query data from Sanity using GraphQL</h1>
      </header>

      <section class="PostMeta">
        <time class="PostMeta-date dt-published">Wed, Aug 14, 2019</time> —
        
<div class="PostMeta-tags">
    <div class="PostMeta-tag">
      
      
        <a href="/tags/today-i-learned" class="p-category">Today I Learned</a>
      
        <a href="/tags/gatsby" class="p-category">Gatsby</a>
      
        <a href="/tags/graphql" class="p-category">GraphQL</a>
      
        <a href="/tags/sanity" class="p-category">Sanity</a>
      
    </div>
</div>

      </section>

      <section class="PostBody e-content">
        <p>I’m making 2 assumptions here, the first is that you have a Sanity project set up, you’ve added at least one content type and you’ve entered some content before <a href="/notes/til-03-deploy-graphql-api-sanity/">deploying a GraphQL API</a>. The second is that you’ve configured a Gatbsy project to work with Sanity, by installing the <code>gatsby-source-sanity</code> plugin.</p>
<p>With those steps complete we can now run our site in development mode using <code>gatsby develop</code>, then head to <code>http://localhost:8000/___graphql</code> to launch GraphiQL and explore our schema.</p>
<h2 id="writing-your-first-sanity-query-in-graphiql">Writing your first Sanity query in GraphiQL&nbsp;<a class="heading-anchor" href="#writing-your-first-sanity-query-in-graphiql" aria-label="Anchor">#</a> </h2>
<p>Type <code>allSanity</code> to launch the options and explore the available document schemas in your API.</p>
<p>One of the available options in my API is <code>allSanityEvent</code> which contains all the data associated with a document type I have created called ‘Event’.</p>
<div class="highlight"><pre class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="p">{</span><span class="w">
</span><span class="w">	</span><span class="py">allSanityEvent</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>We can make a basic query for an event title like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-GraphQL" data-lang="GraphQL"><span class="p">{</span><span class="w">
</span><span class="w">	</span><span class="py">allSanityEvent</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">		</span><span class="py">edges</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">			</span><span class="py">node</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">				</span><span class="py">title</span><span class="w">
</span><span class="w">			</span><span class="p">}</span><span class="w">
</span><span class="w">		</span><span class="p">}</span><span class="w">
</span><span class="w">	</span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><em>Tip: Hit <code>alt + space</code> to see the available options at each level of your query</em></p>
<p>In the particular project I’m working on right now my full query grabs the title, excerpt, slug and image from all events. It looks like this:</p>
<pre><code>{
	allSanityEvent {
		edges {
			node {
				title
				excerpt
				slug {
					current
				}
				image {
					asset {
						fluid {
							src
						}
					}
				}
			}
		}
	}
}
</code></pre><p>And returns the following JSON object:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;allSanityEvent&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;edges&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;node&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;My second event&#34;</span><span class="p">,</span>
            <span class="nt">&#34;excerpt&#34;</span><span class="p">:</span> <span class="s2">&#34;This is the excerpt for the second event&#34;</span><span class="p">,</span>
            <span class="nt">&#34;slug&#34;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&#34;current&#34;</span><span class="p">:</span> <span class="s2">&#34;my-second-event&#34;</span>
            <span class="p">},</span>
            <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&#34;asset&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;fluid&#34;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nt">&#34;src&#34;</span><span class="p">:</span> <span class="s2">&#34;https://cdn.sanity.io/images/k5nyspnm/production/20ef5df9ed8dac42c2ec50b474a46726143ceb4f-2250x1500.png?w=800&amp;h=533&amp;fit=crop&#34;</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;node&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;My first event&#34;</span><span class="p">,</span>
            <span class="nt">&#34;excerpt&#34;</span><span class="p">:</span> <span class="s2">&#34;This is the excerpt for the first event&#34;</span><span class="p">,</span>
            <span class="nt">&#34;slug&#34;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&#34;current&#34;</span><span class="p">:</span> <span class="s2">&#34;my-first-event&#34;</span>
            <span class="p">},</span>
            <span class="nt">&#34;image&#34;</span><span class="p">:</span> <span class="p">{</span>
              <span class="nt">&#34;asset&#34;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&#34;fluid&#34;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nt">&#34;src&#34;</span><span class="p">:</span> <span class="s2">&#34;https://cdn.sanity.io/images/k5nyspnm/production/1c6f3cee364b6cf5bfcad46539b0a9cf82ace1c5-800x400.png?w=800&amp;h=400&amp;fit=crop&#34;</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="query-your-schema-in-gatsby">Query your schema in Gatsby&nbsp;<a class="heading-anchor" href="#query-your-schema-in-gatsby" aria-label="Anchor">#</a> </h2>
<p>Now we have our query we want to show the content in our Gatsby site.</p>
<p>In <code>index.js</code> first we need to import <code>graphql</code>.</p>
<pre><code>import { Link, graphql } from 'gatsby'
</code></pre><p>Next we can write our query and export it as a variable. Make sure you switch out the image <code>src</code> for the ￼image fragment reference.</p>
<pre><code>export const queryEvent = graphql`
{
	allSanityEvent {
		edges {
			node {
				title
				excerpt
				slug {
					current
				}
				image {
					asset {
						fluid {
							...GatsbySanityImageFluid
						}
					}
				}
			}
		}
	}
}
</code></pre><p>Now we can grab the data in our layout.</p>
<pre><code>const IndexPage = ({ data }) =&gt; (
&lt;Layout&gt;
	&lt;h1&gt;Events&lt;/h1&gt;
	&lt;ul&gt;
		{data.allSanityEvent.edges.map(({ node: event }) =&gt; (
			&lt;li key={event.slug.current}&gt;
				&lt;h2&gt;{event.title}&lt;/h2&gt;
				&lt;Image fluid={event.image.asset.fluid} alt={event.title} /&gt;
				&lt;p&gt;{event.excerpt}&lt;/p&gt;
			&lt;/li&gt;
		))}
	&lt;/ul&gt;
&lt;/Layout&gt;
)
</code></pre><p>We now have a list of events on our page, including the event title, image and excerpt.</p>
<p>The next step will be to generate the single pages for each event.</p>
<h2 id="further-resources">Further resources&nbsp;<a class="heading-anchor" href="#further-resources" aria-label="Anchor">#</a> </h2>
<ul>
<li><a href="https://www.gatsbyjs.org/docs/sourcing-from-sanity/">Sourcing from Sanity</a> in the Gatsby Docs.</li>
<li><a href="https://www.youtube.com/watch?v=SLGkyodumKI">Build a portfolio site with Sanity and Gatsby</a> from Jason Lengstorf.</li>
</ul>
 
      </section>

      <footer>
      
<div class="PostAuthor">
  <img alt="Harry Cresswell" class="Avatar Avatar--round Avatar--m u-photo" src="https://harrycresswell.com/img/hc.jpg">
  <div class="PostAuthor-text">
    <h4>Did you enjoy this?</h4>
    <p>Sign up for my newsletter below &darr;</p>
  </div>
</div>


<div hidden>
  <a class="u-url" href="https://azharkhan.in/articles/accessibility-checking-writing-mac-os/">Accessibility check your writing on macOS</a>
  <p class="h-card p-author">
    <a class="p-name u-url" href="https://azharkhan.in/" rel="author">Harry Cresswell</a>
    <img alt="Harry Cresswell" class="u-photo" src="https://harrycresswell.com/img/hc.jpg">
  </p>
</div>
      </footer>

  </article>


    </main>

    <section class="Newsletter" id="braintactics">
    <h3 class="Newsletter-title">Weekly Newsletter</h3>
    <p><a href="/newsletter/">Braintactics</a> is a weekly roundup of articles, tools and tips for product designers and front-end developers. I send it every Friday morning.</p>

    <form class="NewsletterForm validate" action="https://harrycresswell.us14.list-manage.com/subscribe/post?u=4e8fba8d0ab4a857159c0104e&amp;id=d6ad2b65ca" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        
        <div class="NewsletterForm-field">
            <label class="NewsletterForm-label" for="name">
            First Name
            </label>
            <input class="NewsletterForm-input" id="name" name="NAME" placeholder="e.g. Harry" type="text">
        </div>

        <div class="NewsletterForm-field">
            <label class="NewsletterForm-label" for="email">
            Email Address
            </label>
            <input class="NewsletterForm-input" id="email" name="EMAIL" placeholder="e.g. harry@gmail.com" type="email">
        </div>
        <div class="NewsletterForm-field">
        
            
            <input class="u-visually-hidden" name="LOCATION" value="Query data from Sanity using GraphQL" type="hidden" id="mce-LOCATION">
            
        
            <div class="Form-options" style="display:none">
                <strong>Product </strong>
                <ul>
                    <li>
                        <input type="checkbox" value="4" name="group[6417][4]" id="mce-group[6417]-6417-0" checked>
                        <label for="mce-group[6417]-6417-0">Braintactics</label>
                    </li>
                    <li>
                        <input type="checkbox" value="8" name="group[6417][8]" id="mce-group[6417]-6417-1">
                        <label for="mce-group[6417]-6417-1">DS in Sketch</label>
                    </li>
                </ul>
            </div>
            <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
            </div>
            
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <label for="b_4e8fba8d0ab4a857159c0104e_d6ad2b65ca">Prevent bot signups</label>
                <input type="text" name="b_4e8fba8d0ab4a857159c0104e_d6ad2b65ca" tabindex="-1" value="">
            </div>

            <div class="NewsletterForm-button">
                <label class="NewsletterForm-label u-visually-hidden" for="subscribe">Subscribe</label>
                <input class="Button Button--primary" name="subscribe" type="submit" value="Subscribe">
            </div>
        </div>
    </form>
</section>

  <footer class="Footer" role="contentinfo">
    <nav class="FooterNav" aria-label="Footer Navigation">
      
      
      <a class="FooterNav-link"
        href="/articles/">Articles</a>
      
      <a class="FooterNav-link"
        href="/notes/">Notes</a>
      
      <a class="FooterNav-link"
        href="/tags/">Tags</a>
      
    </nav>
    <p>Content &copy;2020 Harry Cresswell, unless otherwise specified. Subscribe to RSS Feeds for <a
        href="https://azharkhan.in/feed.xml">all content</a>, <a
        href="https://azharkhan.in/articles/feed.xml">articles</a> or <a
        href="https://azharkhan.in/notes/feed.xml">notes</a>.</p>
  </footer>

  
  
  
  

  
  
  
  
  
  
  
  
  
  
  <script src="https://azharkhan.in/app.min.633fdaa2db6cbb9888b8f7ce0cb9fff72b593e1c71be0f9a84142171ddb816a5.js" integrity="sha256-Yz/aottsu5iIuPfODLn/9ytZPhxxvg&#43;ahBQhcd24FqU=" media="screen"></script>
  <script>
    var cl = cloudinary.Cloudinary.new({
      cloud_name: "harrycresswell"
    });

    cl.responsive();
  </script>
  </body>

  </html>