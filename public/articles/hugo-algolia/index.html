<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
    
    <title>Static search with Algolia and Hugo | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.</title>
    <meta name="title" content="Static search with Algolia and Hugo | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    
    <meta name="description" content="Learn how to implement Algolia InstantSearch on a Hugo based static site.">
    <meta name="keywords" content="Data Engineering, Data Science, AI, Analytics, Design, UX, UI, Product">
    <meta http-equiv="content-language" content="en" />
    
    <meta property="og:title" content="Static search with Algolia and Hugo | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    <meta property="og:description" content="Learn how to implement Algolia InstantSearch on a Hugo based static site.">
    <meta property="og:site_name" content="Static search with Algolia and Hugo | Azhar Khan &middot; Azhar Khan is an independent data engineer and developer from Ottawa, Canada.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://azharkhan.in/articles/hugo-algolia/">
    
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://azharkhan.in/articles/hugo-algolia/">
    <meta property="twitter:title" content="Static search with Algolia and Hugo - Azhar Khan">
    <meta property="twitter:description" content=" Learn how to implement Algolia InstantSearch on a Hugo based static site. Blog posts on code and design by github.com/XOR97">
    <link rel="canonical" href="https://azharkhan.in/articles/hugo-algolia/">
    
    
    
    <meta name="p:domain_verify" content="c60dc1e9be844be29f0fb5525b9afe6f"/>
    
    <meta name="google-site-verification" content="9G-wiIrmxQgDxbcs3a3xPW--q3Mxb1VGFN7BsEfJdDk" />
    
    <meta name="pinterest" content="nopin" />
        
    <meta name="author" content="Azhar Khan">
    <link href="mailto:azhar932@icloud.com" rel="me">
    <link href="https://twitter.com/Azhr_K_" rel="me">
    <link href="https://github.com/XOR97" rel="me">
    <link href="https://www.linkedin.com/in/azhar93/" rel="me">
    
    <link rel="webmention" href="https://webmention.io/harrycresswell.com/webmention" />
    <link rel="pingback" href="https://webmention.io/harrycresswell.com/xmlrpc" />
    
    
      
      
       
      
      
      <link rel="stylesheet" href="https://azharkhan.in/css/main.min.bf08fe8d86332cb842d75cf7df24b0b53fd52f2d350e68cea9eea8bdf244050b.css" integrity="sha256-vwj&#43;jYYzLLhC11z33ySwtT/VLy01DmjOqe6ovfJEBQs=" media="screen">
    
    
    <link rel="apple-touch-icon" href="https://azharkhan.in/img/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://azharkhan.in/img/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://azharkhan.in/img/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="shortcut icon" href="https://azharkhan.in/img/favicon.ico" type="image/x-icon">
    
    </head>
	<body class="Wrapper h-card">
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header class="Header">
    <div class="Title">
      <a class="p-name u-url" rel="me" href="https://azharkhan.in/">Azhar Khan</a>
      <div hidden>
          <img class="u-photo" src="https://harrycresswell.com/img/hc.jpg" alt="Harry Cresswell">
          <p class="p-note">Azhar Khan is an independent data engineer and developer from Ottawa, Canada.</p>
          <a href="mailto:studio@harrycresswell.com" rel="me" class="u-email">studio@harrycresswell.com</a>
      </div>
    </div>
    <nav class="Nav" aria-label="Main Navigation">
      <ul class="Nav-list">
       
        
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/articles/">Articles</a>
        </li>
      
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/notes/">Notes</a>
        </li>
      
        <li class="Nav-listItem">
          <a class="Nav-listItemLink" href="/tags/">Tags</a>
        </li>
      
      </ul>
    </nav>
  </header>

    <main id="main-content" class="Container">
    
      
  <article id="content" class="Post h-entry">

      <header class="PostHeader">
          <h1 class="PostHeader-title p-name">Static search with Algolia and Hugo</h1>
      </header>
    
      <section class="PostMeta">
        <time class="PostMeta-date dt-published" datetime="2018-07-13 10:15:40 &#43;0200 &#43;0200">Fri, Jul 13, 2018</time> —
        
<div class="PostMeta-tags">
    <div class="PostMeta-tag">
      
      
        <a href="/tags/hugo" class="p-category">Hugo</a>
      
        <a href="/tags/api" class="p-category">API</a>
      
    </div>
</div>

      </section>

      <section class="PostBody e-content">
        <!-- raw HTML omitted -->
<p class="intro">
    We’re about to walk through setting up Algolia search on a Hugo static site with a Forestry CMS, so you can search your posts instantaneously and edit content directly from the browser.
</p>

<p>This first part is heavily based on <a href="https://forestry.io/blog/search-with-algolia-in-hugo/#creating-the-json-template">Chris Macrae’s awesome article on Forestry.io</a>, with some adaptations to fit my specific needs. In the second article we’ll implement Instantsearch.js on the front end, which aims to pick up where the Chris’s article left off.</p>
<h2 id="whats-algolia">What’s Algolia?&nbsp;<a class="heading-anchor" href="#whats-algolia" aria-label="Anchor">#</a> </h2>
<p><a href="https://www.algolia.com/">Algolia</a> is a search API (SaSS; as in <em>Search</em> as a Service) which allows you to index data and server it up at lightning speeds.</p>
<p>If you’re running a <a href="https://jamstack.org/">JAMStack</a> build – a Hugo static site like this one perhaps – Algolia will allow you to implement rapid fire, instantaneous search, like you’ve seen on <a href="https://www.smashingmagazine.com/">Smashing Magazine</a> and all those JS framework sites (think Vue, Gatsby, React).</p>
<p>This stuff isn’t really possible on static sites without using a 3rd party API like Algolia, largely because we don’t have a database to query. But lucky for us Aloglia takes care of all this backend stuff for us.</p>
<p>With that said, let’s break down the plan so you know what’s coming up.</p>
<h2 id="what-are-trying-to-do">What are trying to do?&nbsp;<a class="heading-anchor" href="#what-are-trying-to-do" aria-label="Anchor">#</a> </h2>
<ul>
<li>Send a search index to Algolia when a new post is added (via <a href="https://forestry.io/">Forestry</a> or a <code>git push</code> from the CLI).</li>
<li>Update the search index on our site with a <a href="https://webtask.io/">webtask function</a>, whenever the index is update on Algolia.</li>
<li>Build a front end search using Algolia’s <a href="https://community.algolia.com/instantsearch.js/">Instantsearch.js</a> library, so visitors can interface with our content (we’ll do this bit in the second article).</li>
</ul>
<p>For a very basic prototype of what we’re building, <a href="https://heuristic-hoover-2ec537.netlify.com/">head over here</a>.</p>
<p>I’m assuming you already have a Hugo site set up. If not, I recommend starting out with the <a href="https://github.com/forestryio-templates/hugo-boilerplate">Forestry’s Hugo boilerplate</a>. Here’s <a href="https://forestry.io/blog/up-and-running-with-hugo/">a great how-to guide</a> which will help you get off on the right foot.</p>
<h2 id="step-1-generate-json-search-index">Step 1: Generate JSON search index&nbsp;<a class="heading-anchor" href="#step-1-generate-json-search-index" aria-label="Anchor">#</a> </h2>
<p>Algolia deals with JSON, so we’ll need set up Hugo to output our content as JSON. We can do this with <a href="https://gohugo.io/templates/output-formats/">Custom Output Formats</a>.</p>
<p>Inside your <code>config.toml</code> file add the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="p">[</span>outputFormats.Algolia<span class="p">]</span><span class="w">
</span><span class="w">  </span>baseName<span class="w"> </span>=<span class="w"> </span><span class="s2">&#34;algolia&#34;</span><span class="w">
</span><span class="w">  </span>isPlainText<span class="w"> </span>=<span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span>mediaType<span class="w"> </span>=<span class="w"> </span><span class="s2">&#34;application/json&#34;</span><span class="w">
</span><span class="w">  </span>notAlternative<span class="w"> </span>=<span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">[</span>params.algolia<span class="p">]</span><span class="w">
</span><span class="w">  </span>vars<span class="w"> </span>=<span class="w"> </span><span class="p">[</span><span class="s2">&#34;title&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;summary&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;date&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;publishdate&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;expirydate&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;permalink&#34;</span><span class="p">]</span><span class="w">
</span><span class="w">  </span>params<span class="w"> </span>=<span class="w"> </span><span class="p">[</span><span class="s2">&#34;categories&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;tags&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></div><p>You’ll notice we also specified the <code>params</code> we want Algolia to work with – Categories and Tags.</p>
<h2 id="step-2-build-a-json-template">Step 2: Build a JSON template&nbsp;<a class="heading-anchor" href="#step-2-build-a-json-template" aria-label="Anchor">#</a> </h2>
<p>A JSON template will allow Hugo to render the custom JSON output. This will replace the typical <code>_default/list.html</code> page.</p>
<p>Create a new file at <code>layouts/_default/list.algolia.json</code> and add the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="p">{{</span><span class="cm">/* Generates a valid Algolia search index */</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">$hits</span> <span class="o">:=</span> <span class="nx">slice</span> <span class="o">-</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">$section</span> <span class="o">:=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Site</span><span class="p">.</span><span class="nx">GetPage</span> <span class="s2">&#34;section&#34;</span> <span class="p">.</span><span class="nx">Section</span> <span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">$validVars</span> <span class="o">:=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Param</span> <span class="s2">&#34;algolia.vars&#34;</span> <span class="o">|</span> <span class="k">default</span> <span class="nx">slice</span> <span class="o">-</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">$validParams</span> <span class="o">:=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Param</span> <span class="s2">&#34;algolia.params&#34;</span> <span class="o">|</span> <span class="k">default</span> <span class="nx">slice</span> <span class="o">-</span><span class="p">}}</span>
<span class="p">{{</span><span class="cm">/* Include What Pages? */</span><span class="p">}}</span>
<span class="p">{{</span><span class="cm">/* range $i, $hit := .Site.AllPages */</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">range</span> <span class="nx">$i</span><span class="p">,</span> <span class="nx">$hit</span> <span class="o">:=</span> <span class="nx">where</span> <span class="p">(</span><span class="nx">where</span> <span class="p">.</span><span class="nx">Site</span><span class="p">.</span><span class="nx">Pages</span> <span class="s2">&#34;Type&#34;</span> <span class="s2">&#34;in&#34;</span> <span class="p">(</span><span class="nx">slice</span> <span class="s2">&#34;posts&#34;</span><span class="p">))</span> <span class="s2">&#34;IsPage&#34;</span> <span class="kc">true</span> <span class="o">-</span><span class="p">}}</span>
  <span class="p">{{</span><span class="o">-</span> <span class="nx">$dot</span> <span class="o">:=</span> <span class="p">.</span> <span class="o">-</span><span class="p">}}</span>
  <span class="p">{{</span><span class="o">-</span> <span class="k">if</span> <span class="nx">or</span> <span class="p">(</span><span class="nx">and</span> <span class="p">(</span><span class="nx">$hit</span><span class="p">.</span><span class="nx">IsDescendant</span> <span class="nx">$section</span><span class="p">)</span> <span class="p">(</span><span class="nx">and</span> <span class="p">(</span><span class="nx">not</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Draft</span><span class="p">)</span> <span class="p">(</span><span class="nx">not</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Params</span><span class="p">.</span><span class="kr">private</span><span class="p">)))</span> <span class="nx">$section</span><span class="p">.</span><span class="nx">IsHome</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="cm">/* Set the hit&#39;s objectID */</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">File</span><span class="p">.</span><span class="nx">Path</span> <span class="s2">&#34;objectID&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">UniqueID</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="cm">/* Store built-in page variables in iterable object */</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;content&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Plain</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;date&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">.</span><span class="nx">Unix</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;description&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Description</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;dir&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Dir</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;path&#34;</span> <span class="s2">&#34;temp&#34;</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;expirydate&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">ExpiryDate</span><span class="p">.</span><span class="nx">UTC</span><span class="p">.</span><span class="nx">Unix</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;path&#34;</span> <span class="s2">&#34;temp&#34;</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;fuzzywordcount&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">FuzzyWordCount</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;keywords&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Keywords</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;kind&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Kind</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;lang&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Lang</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;lastmod&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Lastmod</span><span class="p">.</span><span class="nx">UTC</span><span class="p">.</span><span class="nx">Unix</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;permalink&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Permalink</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;publishdate&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">PublishDate</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;readingtime&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">ReadingTime</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;relpermalink&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">RelPermalink</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;summary&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Summary</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;title&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Title</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;type&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Type</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;url&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">URL</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;weight&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Weight</span> <span class="o">-</span><span class="p">}}</span>
	  <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;wordcount&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">WordCount</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;temp&#34;</span> <span class="s2">&#34;section&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Section</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="cm">/* Include valid page vars */</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="nx">range</span> <span class="nx">$key</span><span class="p">,</span> <span class="nx">$param</span> <span class="o">:=</span> <span class="p">(.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">Get</span> <span class="s2">&#34;temp&#34;</span><span class="p">)</span> <span class="o">-</span><span class="p">}}</span>
      <span class="p">{{</span><span class="o">-</span> <span class="k">if</span> <span class="k">in</span> <span class="nx">$validVars</span> <span class="nx">$key</span> <span class="o">-</span><span class="p">}}</span>
        <span class="p">{{</span><span class="o">-</span> <span class="nx">$dot</span><span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">File</span><span class="p">.</span><span class="nx">Path</span> <span class="nx">$key</span> <span class="nx">$param</span> <span class="o">-</span><span class="p">}}</span>
      <span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="cm">/* Include valid page params */</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="nx">range</span> <span class="nx">$key</span><span class="p">,</span> <span class="nx">$param</span> <span class="o">:=</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">Params</span> <span class="o">-</span><span class="p">}}</span>
      <span class="p">{{</span><span class="o">-</span> <span class="k">if</span> <span class="k">in</span> <span class="nx">$validParams</span> <span class="nx">$key</span> <span class="o">-</span><span class="p">}}</span>
        <span class="p">{{</span><span class="o">-</span> <span class="nx">$dot</span><span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">File</span><span class="p">.</span><span class="nx">Path</span> <span class="nx">$key</span> <span class="nx">$param</span> <span class="o">-</span><span class="p">}}</span>
      <span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
    <span class="p">{{</span><span class="o">-</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">SetInMap</span> <span class="s2">&#34;hits&#34;</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">File</span><span class="p">.</span><span class="nx">Path</span> <span class="p">(.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">Get</span> <span class="nx">$hit</span><span class="p">.</span><span class="nx">File</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span> <span class="o">-</span><span class="p">}}</span>
  <span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">end</span> <span class="o">-</span><span class="p">}}</span>
<span class="p">{{</span><span class="o">-</span> <span class="nx">jsonify</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">Scratch</span><span class="p">.</span><span class="nx">GetSortedMapValues</span> <span class="s2">&#34;hits&#34;</span><span class="p">)</span> <span class="o">-</span><span class="p">}}</span>
</code></pre></div><p>Here we loop through all of content inside of <code>content/posts</code>. So if, let’s say, your posts folder is called ‘articles’, make sure you update your code to reflect that. Chris’s tutorial loops through all content including pages, so I modified this to serve only post content as I didn’t want to include pages.</p>
<h2 id="step-3-output-the-index">Step 3: Output the Index&nbsp;<a class="heading-anchor" href="#step-3-output-the-index" aria-label="Anchor">#</a> </h2>
<p>Now we have our custom output layout, variables and page-level params configured, we need to tell Hugo to create the actual JSON index.</p>
<p>Back inside your <code>config.toml</code> file, add the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="p">[</span>outputs<span class="p">]</span><span class="w">
</span><span class="w">  </span>home<span class="w"> </span>=<span class="w"> </span><span class="p">[</span><span class="s2">&#34;HTML&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;RSS&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;Algolia&#34;</span><span class="p">]</span><span class="w">
</span></code></pre></div><p>This tells Hugo to output the HTML document, the RSS Feed, and an Algolia index for your site’s homepage, which contain our list of content.</p>
<p>Build your site with <code>npm run build</code> and you should now find <code>algolia.json</code> in the root directory. We can use this to update our index in Algolia.</p>
<h2 id="step-4-create-an-index-in-algolia">Step 4: Create an index in Algolia&nbsp;<a class="heading-anchor" href="#step-4-create-an-index-in-algolia" aria-label="Anchor">#</a> </h2>
<p><a href="https://www.algolia.com/users/sign_up">Create an account</a> on Algolia and click <em>New Application</em>. Make sure you choose a memorable application name. Next select the region closest to you. Then you’ll be redirected to the app dashboard.</p>
<p>Click the <em>Indices</em> tab, and choose <em>Add New Index</em>. Give your new Index a unique name. I used ’hugolia’ for the hell of it, but you can use what you like; your domain name will do.</p>
<p>Finally, select the <em>API Keys</em> tab, and copy your <em>Application ID</em> and <em>Admin API Key</em>. We’ll need these later, to update the index.</p>
<h2 id="step-5-send-search-index-to-algolia">Step 5: Send search index to Algolia&nbsp;<a class="heading-anchor" href="#step-5-send-search-index-to-algolia" aria-label="Anchor">#</a> </h2>
<p>To send our search index to Algolia, we can use <a href="https://www.npmjs.com/package/atomic-algolia">atomic-algolia</a>, an NPM package that does atomic updates to an Algolia index. This will insure our search index is always in-sync with our website’s content.</p>
<p>Run <code>npm install atomic-algolia --save</code></p>
<p>This installs the atomic-algolia package to our local <code>node_modules</code> folder.</p>
<p>Next, open the newly created <code>package.json</code> file, find &ldquo;scripts&rdquo;, and add the following:</p>
<p><code>&quot;algolia&quot;: &quot;atomic-algolia&quot;</code></p>
<p>Now create a <code>.env</code> file at the root of your project to store our environment variables. Add the following:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">ALGOLIA_APP_ID</span><span class="o">=</span><span class="p">{{</span> <span class="nx">YOUR_APP_ID</span> <span class="p">}}</span>
<span class="nx">ALGOLIA_ADMIN_KEY</span><span class="o">=</span><span class="p">{{</span> <span class="nx">YOUR_ADMIN_KEY</span> <span class="p">}}</span>
<span class="nx">ALGOLIA_INDEX_NAME</span><span class="o">=</span><span class="p">{{</span> <span class="nx">YOUR_INDEX_NAME</span> <span class="p">}}</span>
<span class="nx">ALGOLIA_INDEX_FILE</span><span class="o">=</span><span class="p">{{</span> <span class="nx">PATH</span><span class="o">/</span><span class="nx">TO</span><span class="o">/</span><span class="nx">algolia</span><span class="p">.</span><span class="nx">json</span> <span class="p">}}</span>
</code></pre></div><p>Grab those details from your Algolia Dashboard (See Step 4). If you’re using a different theme the path to your Algolia index file might be in <code>dist/algolia.json</code>. Others might find the file in their public folder.</p>
<p>Now update your index by running:</p>
<p><code>npm run algolia</code></p>
<p>If all went well you should now have an index in Algolia synced with the content on your site.</p>
<h2 id="step-6-updating-your-index-with-serverless-functions">Step 6: Updating your index with serverless functions&nbsp;<a class="heading-anchor" href="#step-6-updating-your-index-with-serverless-functions" aria-label="Anchor">#</a> </h2>
<p>Using Forestry’s <a href="https://github.com/forestryio-templates/serverless-atomic-algolia">open-source serverless Webtask Function</a> we can automatically update our Algolia index each time our site is updated. That way we don’t have to run the NPM script above, each time we make changes.</p>
<p>To get started, clone the template to your local machine by running:</p>
<pre><code>git clone https://github.com/forestryio-templates/serverless-atomic-algolia.git
</code></pre><p>Then install the dependencies:</p>
<pre><code>cd serverless-atomic-algolia
npm install serverless -g &amp;&amp; npm install
</code></pre><h3 id="configuration">Configuration&nbsp;<a class="heading-anchor" href="#configuration" aria-label="Anchor">#</a> </h3>
<p>Next, set up a Webtasks profile if you don’t already have one. This can be done directly from the command line with:</p>
<p><code>serverless config credentials --provider webtasks</code></p>
<p>You’ll be asked for an email and you’ll immediately receive a verification code. Enter the verification code and your profile will be ready to use.</p>
<p>Next, you’ll need to configure the function with your Indices and Algolia app information.</p>
<p>First, copy <code>config/secrets.yml.stub</code> to <code>config/secrets.yml</code> and then open it up in your text editor.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">ALGOLIA_APP_ID</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">{</span>
    <span class="nx">YOUR_APP_ID</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">ALGOLIA_ADMIN_KEY</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">{</span>
    <span class="nx">YOUR_ADMIN_KEY</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">DEBOUNCE</span><span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div><p>Then, open <code>config/index.js</code> and update name to the name of your index that you set up earlier, and url to <code>yourdomain.com/algola.json</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">indexes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;YOUR_INDEX_NAME&#34;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s2">&#34;PUBLIC_URL_OF_INDEX&#34;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">];</span>
  <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">indexes</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div><h3 id="deploying-the-function">Deploying the function&nbsp;<a class="heading-anchor" href="#deploying-the-function" aria-label="Anchor">#</a> </h3>
<p>Now deploy the function by running:</p>
<p><code>serverless deploy</code></p>
<p>In the terminal, you should receive an output for the success of your deployment, including the public URL for your new function.</p>
<p>We’ll need this URL for when we trigger a web hook when changes are made to the site.</p>
<h3 id="setting-up-a-webhook-in-forestry">Setting up a Webhook in Forestry&nbsp;<a class="heading-anchor" href="#setting-up-a-webhook-in-forestry" aria-label="Anchor">#</a> </h3>
<p>All that’s left to do before we move on to the front end is set up a post-deployment web hook with Forestry. This will trigger the serverless deploy when you make a change.</p>
<p>If this is new to you, <a href="https://forestry.io/">Forestry</a> is a lightweight CMS for Jekyll and Hugo sites which is very easy to set up, you just link your Git Repository and you’re good to go.</p>
<p>Once your connected to Forestry, find the <em>Settings</em> page of your site and scroll down to the <em>Webhook URL</em> setting.</p>
<p>Enter the URL you received when deploying your function and click <em>Save Settings</em>.</p>
<p>Now each time Forestry finishes deploying your site, your function will be invoked to update your Algolia index.</p>
<p><em>Note: you can still make updates locally and push changes from the CLI, just make sure you do a <code>git pull</code> so you’re up-to-date with your production site.</em></p>
<h2 id="wrapping-up">Wrapping up&nbsp;<a class="heading-anchor" href="#wrapping-up" aria-label="Anchor">#</a> </h2>
<p>At this point should have a working search index, which watches for any content changes you push to Git then re-indexes Algolia and updates our site.</p>
<p>If you need more details on this whole set up, I highly recommend reading <a href="https://forestry.io/blog/search-with-algolia-in-hugo/?q=&amp;hPP=10&amp;idx=blog&amp;p=0">Chris’s tutorial on Forestry</a> which goes into far more depth in certain places I raced through. Props to Chris for explaining in such detail.</p>
<p>I wrote this down as much for my own understanding as I hope it has been helpful for your own. This was my first real venture using serverless functions and I’m still wrapping my head around them.</p>
<p>With that said, any feedback you might have would be very welcome. <a href="https://twitter.com/harrycresswell">Drop me a tweet</a> or <a href="/contact/">send me a message</a>. I’d be happy to hear from others exploring the world of serverless.</p>
<p><em>Note: In <a href="https://harrycresswell.com/articles/hugo-algolia-2/">part 2 of this article</a> we’ll build the front end, so users can interface with our content and see the power of Algolia on a Hugo static site.</em></p>
<!-- raw HTML omitted -->
<h2 id="further-reading">Further reading&nbsp;<a class="heading-anchor" href="#further-reading" aria-label="Anchor">#</a> </h2>
<ul>
<li><a href="https://forestry.io/blog/search-with-algolia-in-hugo/?q=&amp;hPP=10&amp;idx=blog&amp;p=0">Static site search with Hugo + Algolia</a> by Chris Macrae</li>
<li><a href="https://code.luasoftware.com/tutorials/algolia/add-algolia-search-to-hugo-static-website/">Add Algolia Search To Hugo Static Website</a> by Desmond Lua</li>
</ul>

        
<div class="PostAuthor">
  <img alt="Harry Cresswell" class="Avatar Avatar--round Avatar--m u-photo" src="https://harrycresswell.com/img/hc.jpg">
  <div class="PostAuthor-text">
    <h4>Did you enjoy this?</h4>
    <p>Sign up for my newsletter below &darr;</p>
  </div>
</div>


<div hidden>
  <a class="u-url" href="https://azharkhan.in/articles/accessibility-checking-writing-mac-os/">Accessibility check your writing on macOS</a>
  <p class="h-card p-author">
    <a class="p-name u-url" href="https://azharkhan.in/" rel="author">Harry Cresswell</a>
    <img alt="Harry Cresswell" class="u-photo" src="https://harrycresswell.com/img/hc.jpg">
  </p>
</div>
      </section>

  </article>


    </main>

    <section class="Newsletter" id="braintactics">
    <h3 class="Newsletter-title">Weekly Newsletter</h3>
    <p><a href="/newsletter/">Braintactics</a> is a weekly roundup of articles, tools and tips for product designers and front-end developers. I send it every Friday morning.</p>

    <form class="NewsletterForm validate" action="https://harrycresswell.us14.list-manage.com/subscribe/post?u=4e8fba8d0ab4a857159c0104e&amp;id=d6ad2b65ca" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate>
        
        <div class="NewsletterForm-field">
            <label class="NewsletterForm-label" for="name">
            First Name
            </label>
            <input class="NewsletterForm-input" id="name" name="NAME" placeholder="e.g. Harry" type="text">
        </div>

        <div class="NewsletterForm-field">
            <label class="NewsletterForm-label" for="email">
            Email Address
            </label>
            <input class="NewsletterForm-input" id="email" name="EMAIL" placeholder="e.g. harry@gmail.com" type="email">
        </div>
        <div class="NewsletterForm-field">
        
            
            <input class="u-visually-hidden" name="LOCATION" value="Static search with Algolia and Hugo" type="hidden" id="mce-LOCATION">
            
        
            <div class="Form-options" style="display:none">
                <strong>Product </strong>
                <ul>
                    <li>
                        <input type="checkbox" value="4" name="group[6417][4]" id="mce-group[6417]-6417-0" checked>
                        <label for="mce-group[6417]-6417-0">Braintactics</label>
                    </li>
                    <li>
                        <input type="checkbox" value="8" name="group[6417][8]" id="mce-group[6417]-6417-1">
                        <label for="mce-group[6417]-6417-1">DS in Sketch</label>
                    </li>
                </ul>
            </div>
            <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
            </div>
            
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <label for="b_4e8fba8d0ab4a857159c0104e_d6ad2b65ca">Prevent bot signups</label>
                <input type="text" name="b_4e8fba8d0ab4a857159c0104e_d6ad2b65ca" tabindex="-1" value="">
            </div>

            <div class="NewsletterForm-button">
                <label class="NewsletterForm-label u-visually-hidden" for="subscribe">Subscribe</label>
                <input class="Button Button--primary" name="subscribe" type="submit" value="Subscribe">
            </div>
        </div>
    </form>
</section>

  <footer class="Footer" role="contentinfo">
    <nav class="FooterNav" aria-label="Footer Navigation">
      
      
      <a class="FooterNav-link"
        href="/articles/">Articles</a>
      
      <a class="FooterNav-link"
        href="/notes/">Notes</a>
      
      <a class="FooterNav-link"
        href="/tags/">Tags</a>
      
    </nav>
    <p>Content &copy;2020 Harry Cresswell, unless otherwise specified. Subscribe to RSS Feeds for <a
        href="https://azharkhan.in/feed.xml">all content</a>, <a
        href="https://azharkhan.in/articles/feed.xml">articles</a> or <a
        href="https://azharkhan.in/notes/feed.xml">notes</a>.</p>
  </footer>

  
  
  
  

  
  
  
  
  
  
  
  
  
  
  <script src="https://azharkhan.in/app.min.633fdaa2db6cbb9888b8f7ce0cb9fff72b593e1c71be0f9a84142171ddb816a5.js" integrity="sha256-Yz/aottsu5iIuPfODLn/9ytZPhxxvg&#43;ahBQhcd24FqU=" media="screen"></script>
  <script>
    var cl = cloudinary.Cloudinary.new({
      cloud_name: "harrycresswell"
    });

    cl.responsive();
  </script>
  </body>

  </html>